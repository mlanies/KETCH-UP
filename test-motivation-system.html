<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wine: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .card {
            @apply bg-slate-800/80 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 shadow-lg hover:shadow-xl transition-all duration-200;
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">üß† –¢–µ—Å—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</h1>
        
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ chatId -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–∞</h2>
            <div class="flex gap-4 items-end">
                <div class="flex-1">
                    <label class="block text-sm font-medium mb-2">Chat ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input type="number" id="chatId" placeholder="123456789" 
                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-wine-500">
                </div>
                <button onclick="testMotivationSystem()" 
                        class="px-6 py-2 bg-wine-600 hover:bg-wine-700 text-white rounded-lg transition-colors">
                    –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
                </button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ -->
        <div id="results" class="space-y-6"></div>

        <!-- –õ–æ–≥–∏ -->
        <div class="card mt-6">
            <h2 class="text-xl font-semibold mb-4">–õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
            <div id="logs" class="bg-slate-900 p-4 rounded-lg font-mono text-sm max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://telegram-wine-bot.2gc.workers.dev';
        
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-400';
            logsDiv.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function showResult(title, data, success = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `card ${success ? 'border-green-500/30' : 'border-red-500/30'}`;
            
            resultDiv.innerHTML = `
                <h3 class="text-lg font-semibold mb-3 ${success ? 'text-green-400' : 'text-red-400'}">
                    ${success ? '‚úÖ' : '‚ùå'} ${title}
                </h3>
                <pre class="bg-slate-900 p-4 rounded-lg overflow-x-auto text-sm">${JSON.stringify(data, null, 2)}</pre>
            `;
            
            resultsDiv.appendChild(resultDiv);
        }

        async function testMotivationSystem() {
            const chatId = document.getElementById('chatId').value;
            if (!chatId) {
                alert('–í–≤–µ–¥–∏—Ç–µ Chat ID');
                return;
            }

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('results').innerHTML = '';
            document.getElementById('logs').innerHTML = '';

            log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã...', 'info');

            try {
                // –¢–µ—Å—Ç 1: –ê–Ω–∞–ª–∏–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–∏
                log('–¢–µ—Å—Ç 1: –ê–Ω–∞–ª–∏–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                const motivationResponse = await fetch(`${API_BASE_URL}/motivation/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chatId: parseInt(chatId) })
                });
                
                const motivationData = await motivationResponse.json();
                if (motivationResponse.ok && motivationData.success) {
                    log('‚úÖ –ê–Ω–∞–ª–∏–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —É—Å–ø–µ—à–µ–Ω', 'success');
                    showResult('–ê–Ω–∞–ª–∏–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–∏', motivationData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–∏: ${motivationData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–ê–Ω–∞–ª–∏–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–∏', motivationData, false);
                }

                // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                log('–¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                const statsResponse = await fetch(`${API_BASE_URL}/user-stats?chatId=${chatId}`);
                const statsData = await statsResponse.json();
                if (statsResponse.ok) {
                    log('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω–∞', 'success');
                    showResult('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', statsData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${statsData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', statsData, false);
                }

                // –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                log('–¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                const achievementsResponse = await fetch(`${API_BASE_URL}/achievements/user?chatId=${chatId}`);
                const achievementsData = await achievementsResponse.json();
                if (achievementsResponse.ok && achievementsData.success) {
                    log('‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã', 'success');
                    showResult('–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', achievementsData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π: ${achievementsData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', achievementsData, false);
                }

                // –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥
                log('–¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                const rewardsResponse = await fetch(`${API_BASE_URL}/rewards/user?chatId=${chatId}`);
                const rewardsData = await rewardsResponse.json();
                if (rewardsResponse.ok && rewardsData.success) {
                    log('‚úÖ –ù–∞–≥—Ä–∞–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã', 'success');
                    showResult('–ù–∞–≥—Ä–∞–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', rewardsData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥: ${rewardsData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–ù–∞–≥—Ä–∞–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', rewardsData, false);
                }

                // –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                log('–¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...', 'info');
                const messagesResponse = await fetch(`${API_BASE_URL}/motivation/messages?chatId=${chatId}`);
                const messagesData = await messagesResponse.json();
                if (messagesResponse.ok && messagesData.success) {
                    log('‚úÖ –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã', 'success');
                    showResult('–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è', messagesData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: ${messagesData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è', messagesData, false);
                }

                // –¢–µ—Å—Ç 6: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
                log('–¢–µ—Å—Ç 6: –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞...', 'info');
                const quickTestResponse = await fetch(`${API_BASE_URL}/start-quick-test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chatId: parseInt(chatId) })
                });
                const quickTestData = await quickTestResponse.json();
                if (quickTestResponse.ok && quickTestData.success) {
                    log('‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω', 'success');
                    showResult('–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç', quickTestData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞: ${quickTestData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç', quickTestData, false);
                }

                // –¢–µ—Å—Ç 7: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                log('–¢–µ—Å—Ç 7: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...', 'info');
                const categoriesResponse = await fetch(`${API_BASE_URL}/categories`);
                const categoriesData = await categoriesResponse.json();
                if (categoriesResponse.ok && categoriesData.success) {
                    log('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—É—á–µ–Ω—ã', 'success');
                    showResult('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', categoriesData);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ${categoriesData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    showResult('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', categoriesData, false);
                }

                log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'success');

            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                showResult('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', { error: error.message }, false);
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ chatId
        document.getElementById('chatId').value = '123456789';
    </script>
</body>
</html> 