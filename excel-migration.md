# Миграция данных из Excel в Google Sheets

## Подготовка данных

### 1. Структурирование Excel файла

Ваш файл `Pro A.xlsx` должен быть приведен к следующей структуре:

| Название | Сахар | Крепость | Страна | Описание | Изображение |
|----------|-------|----------|--------|----------|-------------|
| Вино 1   | Сухое | 11%      | Испания| Описание| URL картинки|
| Вино 2   | Полусухое| 11.5% | Италия | Описание| URL картинки|

### 2. Рекомендации по форматированию

**Название:**
- Используйте полные названия вин
- Избегайте дублирования
- Убедитесь в уникальности

**Сахар:**
- Стандартизируйте значения: "Сухое", "Полусухое", "Полусладкое", "Сладкое"
- Используйте единообразное написание

**Крепость:**
- Формат: "11%", "11.5%", "12%", "13%", "14%"
- Указывайте точные значения

**Страна:**
- Используйте полные названия стран
- Стандартизируйте написание

**Описание:**
- Краткое описание вкуса и аромата
- 2-3 предложения максимум
- Используйте эмодзи для наглядности

**Изображение:**
- URL-ссылки на изображения
- Рекомендуется использовать Google Drive или другое облачное хранилище
- Формат: `https://drive.google.com/uc?id=FILE_ID`

## Создание Google Sheets

### 1. Создание новой таблицы

1. Перейдите на [Google Sheets](https://sheets.google.com)
2. Создайте новую таблицу
3. Назовите лист "Вина"
4. Скопируйте данные из Excel

### 2. Настройка доступа

1. Нажмите "Настройки доступа" (Share)
2. Установите доступ "Доступно всем, у кого есть ссылка"
3. Разрешите "Просмотр"

### 3. Получение ID таблицы

ID таблицы находится в URL:
```
https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit
```

Скопируйте `SPREADSHEET_ID` для использования в боте.

## Автоматизация миграции

### Python скрипт для конвертации

```python
import pandas as pd
import gspread
from google.oauth2.service_account import Credentials

def migrate_excel_to_sheets(excel_file, sheet_name, credentials_file):
    # Чтение Excel файла
    df = pd.read_excel(excel_file)
    
    # Переименование колонок (при необходимости)
    column_mapping = {
        'Название вина': 'Название',
        'Содержание сахара': 'Сахар',
        'Алкоголь': 'Крепость',
        'Страна производства': 'Страна',
        'Описание вкуса': 'Описание',
        'Фото': 'Изображение'
    }
    
    df = df.rename(columns=column_mapping)
    
    # Стандартизация значений
    df['Сахар'] = df['Сахар'].str.strip().str.title()
    df['Крепость'] = df['Крепость'].astype(str) + '%'
    df['Страна'] = df['Страна'].str.strip().str.title()
    
    # Настройка Google Sheets API
    scope = ['https://spreadsheets.google.com/feeds',
             'https://www.googleapis.com/auth/drive']
    
    credentials = Credentials.from_service_account_file(credentials_file, scopes=scope)
    gc = gspread.authorize(credentials)
    
    # Создание или открытие таблицы
    try:
        sheet = gc.open(sheet_name)
    except:
        sheet = gc.create(sheet_name)
    
    worksheet = sheet.get_worksheet(0)
    
    # Загрузка данных
    data = [df.columns.tolist()] + df.values.tolist()
    worksheet.update('A1', data)
    
    print(f"Данные успешно загружены в {sheet_name}")
    print(f"ID таблицы: {sheet.id}")

# Использование
migrate_excel_to_sheets('Pro A.xlsx', 'Вина', 'credentials.json')
```

### Требования для скрипта

```bash
pip install pandas openpyxl gspread google-auth
```

## Ручная миграция

### 1. Экспорт из Excel

1. Откройте `Pro A.xlsx`
2. Выделите нужные данные
3. Скопируйте в буфер обмена (Ctrl+C)

### 2. Импорт в Google Sheets

1. Откройте Google Sheets
2. Вставьте данные (Ctrl+V)
3. Проверьте форматирование
4. Сохраните изменения

### 3. Проверка данных

1. Убедитесь, что все колонки на месте
2. Проверьте корректность значений
3. Исправьте ошибки форматирования

## Настройка изображений

### 1. Загрузка в Google Drive

1. Создайте папку для изображений вин
2. Загрузите все изображения
3. Получите ссылки для каждого файла

### 2. Получение прямых ссылок

Для Google Drive используйте формат:
```
https://drive.google.com/uc?id=FILE_ID
```

### 3. Альтернативные хранилища

- **Cloudinary**: Бесплатный хостинг изображений
- **Imgur**: Простая загрузка и получение ссылок
- **AWS S3**: Для больших объемов

## Тестирование

### 1. Проверка API доступа

```bash
curl "https://sheets.googleapis.com/v4/spreadsheets/YOUR_SPREADSHEET_ID/values/M1:R65?key=YOUR_API_KEY"
```

### 2. Тестирование бота

1. Разверните бота
2. Отправьте команду `/start`
3. Проверьте загрузку данных
4. Протестируйте фильтры

## Устранение проблем

### Частые ошибки

1. **"No data found"** - Проверьте диапазон M1:R65
2. **"Access denied"** - Настройте права доступа к таблице
3. **"Invalid API key"** - Проверьте правильность API ключа
4. **"Empty response"** - Убедитесь, что данные есть в указанном диапазоне

### Отладка

1. Проверьте логи в Cloudflare Workers Dashboard
2. Используйте endpoint `/status` для проверки бота
3. Проверьте доступность Google Sheets API

## Обновление данных

### Автоматическое обновление

Данные автоматически кешируются на 1 час. Для принудительного обновления:

1. В боте: `/refresh`
2. API: `POST /refresh-data`

### Ручное обновление

1. Измените данные в Google Sheets
2. Подождите до 1 часа или принудительно обновите
3. Проверьте изменения в боте 